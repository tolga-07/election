<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Congress Swingometer</title>

<style>
  :root {
    --bg-app: #05060a;
    --bg-panel: #141720;
    --bg-panel-soft: #1b1f2a;
    --text-main: #ececf1;
    --text-muted: #8a8f98;
    --border-subtle: rgba(255, 255, 255, 0.06);

    /* REPUBLICAN SHADES */
    --rep-safe:   #b91c1c; /* 15+ */
    --rep-solid:  #dc2626; /* 5-15 */
    --rep-likely: #ef4444; /* 2.5-5 */
    --rep-lean:   #f87171; /* 1-2.5 */
    --rep-tilt:   #fca5a5; /* 0-1 */

    --tossup-pure: #444444;

    /* DEMOCRAT SHADES */
    --dem-tilt:   #93c5fd; /* 0-1 */
    --dem-lean:   #60a5fa; /* 1-2.5 */
    --dem-likely: #3b82f6; /* 2.5-5 */
    --dem-solid:  #2563eb; /* 5-15 */
    --dem-safe:   #1e40af; /* 15+ */

    /* Glows for main safe numbers */
    --glow-rep: rgba(220, 38, 38, 0.4);
    --glow-dem: rgba(37, 99, 235, 0.4);

    --accent-gold: #fbbf24;
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 16px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
      sans-serif;
    background:
      radial-gradient(circle at top left, #111827 0, #020617 55%),
      radial-gradient(circle at bottom right, #0f172a 0, #020617 55%);
    color: var(--text-main);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  /* --- Header --- */
  header {
    width: 100%;
    max-width: 1300px;
    margin-bottom: 18px;
  }

  .header-top {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: baseline;
    gap: 10px;
    margin-bottom: 10px;
  }

  h1 {
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: -0.03em;
    margin: 0;
    font-size: 1.9rem;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  h1 span.badge-year {
    font-size: 0.75rem;
    padding: 3px 7px;
    border-radius: 999px;
    background: rgba(148, 163, 184, 0.16);
    border: 1px solid rgba(148, 163, 184, 0.35);
    text-transform: uppercase;
    letter-spacing: 0.12em;
  }

  .header-sub {
    font-size: 0.8rem;
    color: var(--text-muted);
    max-width: 420px;
    line-height: 1.4;
  }

  .meta-pill-row {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 6px;
  }

  .meta-pill {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    padding: 3px 8px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    background: rgba(15, 23, 42, 0.8);
    color: #cbd5f5;
  }

  /* --- Scoreboards --- */
  .scoreboard-wrapper {
    display: grid;
    grid-template-columns: minmax(0, 1fr);
    gap: 16px;
    width: 100%;
  }

  @media (min-width: 880px) {
    .scoreboard-wrapper {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  .scoreboard {
    display: flex;
    flex-direction: column;
    background: var(--bg-panel);
    padding: 12px 14px 10px;
    border-radius: 12px;
    border: 1px solid var(--border-subtle);
    box-shadow: 0 18px 40px rgba(0, 0, 0, 0.38);
    position: relative;
    overflow: hidden;
  }

  .scoreboard::before {
    content: "";
    position: absolute;
    inset: -40%;
    opacity: 0.15;
    background:
      radial-gradient(circle at -10% 0%, rgba(239, 68, 68, 0.5), transparent 55%),
      radial-gradient(circle at 110% 100%, rgba(59, 130, 246, 0.5), transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  .scoreboard-inner {
    position: relative;
    z-index: 1;
  }

  .chamber-label {
    font-size: 0.9rem;
    font-weight: 700;
    color: #f9fafb;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 6px;
  }

  .chamber-label span {
    opacity: 0.7;
    font-weight: 400;
    font-size: 0.78em;
  }

  .totals-bar {
    display: flex;
    justify-content: space-between;
    align-items: stretch;
    margin-bottom: 10px;
    gap: 12px;
  }

  .total-box {
    flex: 1;
    text-align: center;
    padding: 4px 6px;
    border-radius: 10px;
    background: radial-gradient(circle at 50% 0%, rgba(15, 23, 42, 0.6), transparent 70%);
  }

  .total-num {
    font-size: 2.3rem;
    font-weight: 900;
    line-height: 1;
  }

  .total-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.13em;
    opacity: 0.8;
    margin-top: 1px;
  }

  .t-rep {
    color: var(--rep-solid);
    text-shadow: 0 0 15px rgba(220, 38, 38, 0.22);
  }

  .t-dem {
    color: var(--dem-solid);
    text-shadow: 0 0 15px rgba(37, 99, 235, 0.22);
  }

  .majority-bar-wrapper {
    margin-bottom: 10px;
  }

  .majority-bar {
    height: 7px;
    border-radius: 999px;
    background: #020617;
    border: 1px solid rgba(148, 163, 184, 0.45);
    overflow: hidden;
    position: relative;
    display: flex;
  }

  .majority-segment {
    height: 100%;
    transition: width 0.15s ease-out;
  }

  .majority-segment.rep {
    background: linear-gradient(to right, #7f1d1d, #ef4444);
  }

  .majority-segment.dem {
    background: linear-gradient(to right, #3b82f6, #1d4ed8);
  }

  .majority-marker {
    position: absolute;
    top: -3px;
    width: 0;
    border-left: 1px solid rgba(249, 250, 251, 0.9);
    height: 13px;
  }

  .majority-marker::after {
    content: "M";
    position: absolute;
    top: -10px;
    left: 3px;
    font-size: 0.55rem;
    color: rgba(148, 163, 184, 0.9);
  }

  .majority-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 4px;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--text-muted);
  }

  .status-line {
    font-size: 0.78rem;
    color: #e5e7eb;
    margin-bottom: 6px;
    display: flex;
    justify-content: space-between;
    gap: 8px;
    flex-wrap: wrap;
  }

  .status-primary {
    font-weight: 600;
  }

  .status-primary span.party {
    font-weight: 800;
  }

  .status-primary span.party.dem {
    color: var(--dem-lean);
  }

  .status-primary span.party.rep {
    color: var(--rep-lean);
  }

  .status-secondary {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--text-muted);
  }

  .status-secondary strong {
    color: #e5e7eb;
  }

  .breakdown-grid {
    display: grid;
    grid-template-columns: repeat(5, minmax(0, 1fr)) 0.75fr repeat(5, minmax(0, 1fr));
    gap: 2px;
    align-items: center;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
    padding-top: 10px;
  }

  .score-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    padding: 0 4px;
  }

  .score-card:not(:last-child)::after {
    content: "";
    position: absolute;
    right: 0;
    top: 20%;
    height: 60%;
    width: 1px;
    background: rgba(255, 255, 255, 0.04);
  }

  .score-value {
    font-size: 1.1rem;
    font-weight: 800;
    line-height: 1;
  }

  .score-label {
    font-size: 0.52rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin-top: 3px;
    text-align: center;
    white-space: nowrap;
  }

  /* Republican text colors */
  .sc-r-safe .score-value {
    color: var(--rep-safe);
    text-shadow: 0 0 10px var(--glow-rep);
  }
  .sc-r-solid .score-value {
    color: var(--rep-solid);
  }
  .sc-r-likely .score-value {
    color: var(--rep-likely);
  }
  .sc-r-lean .score-value {
    color: var(--rep-lean);
  }
  .sc-r-tilt .score-value {
    color: var(--rep-tilt);
  }

  .sc-t .score-value {
    color: #9ca3af;
  }

  /* Democrat text colors */
  .sc-d-tilt .score-value {
    color: var(--dem-tilt);
  }
  .sc-d-lean .score-value {
    color: var(--dem-lean);
  }
  .sc-d-likely .score-value {
    color: var(--dem-likely);
  }
  .sc-d-solid .score-value {
    color: var(--dem-solid);
  }
  .sc-d-safe .score-value {
    color: var(--dem-safe);
    text-shadow: 0 0 10px var(--glow-dem);
  }

  /* --- Controls --- */
  .controls-container {
    background: var(--bg-panel-soft);
    padding: 14px 18px;
    border-radius: 14px;
    width: 100%;
    max-width: 980px;
    margin: 18px auto 24px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    position: sticky;
    top: 8px;
    z-index: 500;
    backdrop-filter: blur(16px);
    box-shadow: 0 18px 32px rgba(0, 0, 0, 0.6);
  }

  .controls-header-row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 10px;
    margin-bottom: 6px;
  }

  .slider-header {
    font-size: 0.88rem;
    font-weight: 600;
  }

  .slider-header span {
    font-weight: 700;
  }

  .slider-caption {
    font-size: 0.7rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.16em;
  }

  .slider-row {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  input[type="range"] {
    flex: 1;
    appearance: none;
    background: transparent;
    cursor: pointer;
  }

  input[type="range"]::-webkit-slider-runnable-track {
    background: linear-gradient(
      to right,
      var(--dem-safe),
      var(--dem-tilt),
      #6b7280,
      var(--rep-tilt),
      var(--rep-safe)
    );
    height: 8px;
    border-radius: 999px;
  }

  input[type="range"]::-moz-range-track {
    background: linear-gradient(
      to right,
      var(--dem-safe),
      var(--dem-tilt),
      #6b7280,
      var(--rep-tilt),
      var(--rep-safe)
    );
    height: 8px;
    border-radius: 999px;
  }

  input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    height: 22px;
    width: 22px;
    background: #f9fafb;
    border-radius: 50%;
    margin-top: -7px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
    border: 2px solid #0f172a;
    transition: transform 0.07s ease-out, box-shadow 0.07s ease-out;
  }

  input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.08);
    box-shadow: 0 0 0 3px rgba(249, 250, 251, 0.12);
  }

  input[type="range"]::-moz-range-thumb {
    height: 20px;
    width: 20px;
    background: #f9fafb;
    border-radius: 50%;
    border: 2px solid #0f172a;
  }

  .slider-scale {
    margin-top: 2px;
    display: flex;
    justify-content: space-between;
    font-size: 0.65rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.13em;
  }

  .slider-scale span.center {
    color: #e5e7eb;
  }

  .preset-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 8px;
  }

  .preset-btn {
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.6);
    background: rgba(15, 23, 42, 0.9);
    padding: 4px 9px;
    font-size: 0.68rem;
    text-transform: uppercase;
    letter-spacing: 0.16em;
    color: #cbd5f5;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .preset-btn span.badge {
    font-size: 0.65rem;
    padding: 2px 5px;
    border-radius: 999px;
    background: rgba(15, 23, 42, 0.85);
  }

  .preset-btn:hover {
    background: #020617;
  }

  .preset-btn.active {
    border-color: var(--accent-gold);
    color: #fef9c3;
    box-shadow: 0 0 0 1px rgba(250, 204, 21, 0.45);
  }

  .legend {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 8px 12px;
    margin-top: 10px;
    font-size: 0.65rem;
    color: var(--text-muted);
    text-transform: uppercase;
  }

  .legend-item {
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .legend-item b {
    font-weight: 600;
    color: #e5e7eb;
  }

  .dot {
    width: 10px;
    height: 10px;
    border-radius: 2px;
  }

  /* --- Visualizations (Side by Side Grid) --- */
  .vis-container {
    width: 100%;
    max-width: 1400px;
    display: grid;
    grid-template-columns: minmax(0, 1.3fr) minmax(0, 0.9fr);
    gap: 18px;
    align-items: flex-start;
  }

  @media (max-width: 1000px) {
    .vis-container {
      grid-template-columns: minmax(0, 1fr);
    }

    .breakdown-grid {
      grid-template-columns: repeat(5, minmax(0, 1fr));
      grid-template-rows: auto auto auto;
    }

    .sc-t {
      grid-column: 1 / -1;
      margin: 8px 0;
      border-top: 1px solid #333;
      border-bottom: 1px solid #333;
      padding: 4px 0;
    }

    .chamber-label {
      margin-bottom: 12px;
    }
  }

  .panel {
    background: rgba(15, 23, 42, 0.85);
    border-radius: 14px;
    border: 1px solid var(--border-subtle);
    overflow: hidden;
    min-height: 460px;
    box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
  }

  h2.section-title {
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.18em;
    color: var(--text-main);
    margin: 0;
    text-align: center;
    background: linear-gradient(to right, #020617, #020617),
      radial-gradient(circle at 0% 0%, rgba(59, 130, 246, 0.4), transparent 55%);
    padding: 9px 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  }

  h2.section-title span.sub {
    display: block;
    font-size: 0.65rem;
    text-transform: none;
    letter-spacing: 0.04em;
    color: var(--text-muted);
    margin-top: 2px;
  }

  /* HOUSE MAP */
  .map-wrapper {
    width: 100%;
    display: flex;
    justify-content: center;
    padding: 18px 4px 20px;
  }

  
  .house-svg-container{
    width: min(1060px, 100%);
    aspect-ratio: 975 / 610;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.06);
    background: rgba(2, 6, 23, 0.55);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03);
  }

  .house-svg-container svg{
    width: 100%;
    height: 100%;
    display: block;
  }

  .house-loading, .house-error{
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    font-size: 0.92rem;
    padding: 28px;
    text-align: center;
  }

  #house-svg-container path.cdNEW{
    vector-effect: non-scaling-stroke;
    transition: filter 120ms ease, stroke-width 120ms ease, stroke-opacity 120ms ease, opacity 120ms ease;
  }

  #house-svg-container path.cdNEW:hover{
    filter: drop-shadow(0 0 4px rgba(255,255,255,0.35));
    stroke: rgba(255,255,255,0.85);
    stroke-opacity: 0.95;
    stroke-width: 1.2;
  }
.us-grid {
    display: grid;
    grid-template-columns: repeat(12, 38px);
    grid-template-rows: repeat(8, 38px);
    gap: 3px;
  }

  .state-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding-top: 4px;
    position: relative;
  }

  .state-label {
    font-size: 8px;
    font-weight: 700;
    color: var(--text-muted);
    margin-bottom: 3px;
    pointer-events: none;
    opacity: 0.6;
  }

  .districts-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 2px;
    max-width: 36px;
  }

  .district-dot {
    width: 6px;
    height: 6px;
    border-radius: 1px;
    background-color: var(--tossup-pure);
    cursor: pointer;
    transition: transform 0.12s ease-out, background-color 0.15s;
  }

  .district-dot:hover {
    transform: scale(2.4);
    z-index: 20;
    border: 1px solid white;
  }

  /* SENATE SPECTRUM (VERTICAL SNAKE) */
  .senate-spectrum-wrapper {
    padding: 14px 14px 18px;
  }

  .senate-label-row {
    display: flex;
    justify-content: space-between;
    width: 100%;
    font-size: 0.72rem;
    color: var(--text-muted);
    text-transform: uppercase;
    margin-bottom: 8px;
    padding: 0 2px 4px;
    border-bottom: 1px solid #242938;
  }

  .senate-label-row strong {
    color: #e5e7eb;
  }

  .senate-spectrum {
    display: grid;
    grid-template-rows: repeat(5, 1fr);
    gap: 8px;
    padding-top: 6px;
    justify-content: center;
    grid-auto-columns: 40px;
  }

  .senate-seat {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--tossup-pure);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.86);
    cursor: pointer;
    transition: all 0.16s ease-out;
    border: 2px solid transparent;
    position: relative;
  }

  .senate-seat:hover {
    transform: scale(1.26);
    border-color: white;
    z-index: 10;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.65);
  }

  .senate-seat.tipping {
    box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.8),
      0 0 20px rgba(250, 204, 21, 0.4);
    border-color: var(--accent-gold);
  }

  .senate-seat.tipping::after {
    content: "★";
    position: absolute;
    bottom: -12px;
    font-size: 0.55rem;
    color: var(--accent-gold);
  }

  /* --- Tooltip --- */
  #tooltip {
    position: fixed;
    background: rgba(15, 23, 42, 0.98);
    border: 1px solid #4b5563;
    padding: 9px 10px 8px;
    border-radius: 7px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.08s ease-out;
    z-index: 1000;
    font-size: 11px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.75);
    min-width: 155px;
    max-width: 230px;
  }

  #tooltip strong.tt-title {
    color: #f9fafb;
    display: block;
    margin-bottom: 4px;
    font-size: 12px;
  }

  #tooltip .tt-subtitle {
    font-size: 10px;
    color: var(--text-muted);
    margin-bottom: 4px;
  }

  #tooltip .tt-divider {
    border-top: 1px solid #374151;
    margin: 4px 0;
  }

  #tooltip .row {
    display: flex;
    justify-content: space-between;
    color: #9ca3af;
    margin-bottom: 2px;
  }

  #tooltip .val {
    color: #e5e7eb;
    font-weight: 600;
  }

  #tooltip .pill {
    display: inline-block;
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    padding: 1px 6px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.6);
    color: #e5e7eb;
  }

  /* --- Logic Classes (colors) --- */
  .r-safe {
    background-color: var(--rep-safe);
  }
  .r-solid {
    background-color: var(--rep-solid);
  }
  .r-likely {
    background-color: var(--rep-likely);
  }
  .r-lean {
    background-color: var(--rep-lean);
  }
  .r-tilt {
    background-color: var(--rep-tilt);
  }

  .pure-toss {
    background-color: var(--tossup-pure);
  }

  .d-tilt {
    background-color: var(--dem-tilt);
  }
  .d-lean {
    background-color: var(--dem-lean);
  }
  .d-likely {
    background-color: var(--dem-likely);
  }
  .d-solid {
    background-color: var(--dem-solid);
  }
  .d-safe {
    background-color: var(--dem-safe);
  }
</style>
</head>
<body>
  <header>
    <div class="header-top">
      <h1>
        Congress Swingometer
        <span class="badge-year">Uniform swing</span>
      </h1>
      <div class="header-sub">Drag the slider. The map updates using a uniform two-party swing.</div>
    </div>

    <div class="scoreboard-wrapper">
      <!-- HOUSE SCOREBOARD -->
      <div class="scoreboard">
        <div class="scoreboard-inner">
          <div class="chamber-label">
            House
            <span>Majority: 218</span>
          </div>

          <div class="totals-bar">
            <div class="total-box">
              <div class="total-num t-rep" id="h-total-r">0</div>
              <div class="total-label">R seats</div>
            </div>
            <div class="total-box">
              <div class="total-num t-dem" id="h-total-d">0</div>
              <div class="total-label">D seats</div>
            </div>
          </div>

          <div class="majority-bar-wrapper">
            <div class="majority-bar" id="house-majority-bar">
              <div
                class="majority-segment rep"
                id="house-bar-r"
                style="width: 0%"
              ></div>
              <div
                class="majority-segment dem"
                id="house-bar-d"
                style="width: 0%"
              ></div>
              <div
                class="majority-marker"
                id="house-majority-marker"
              ></div>
            </div>
            <div class="majority-labels">
              <span>0</span>
              <span>435</span>
            </div>
          </div>

          <div class="status-line">
            <div class="status-primary" id="house-status-primary">
              –
            </div>
            <div class="status-secondary" id="house-status-secondary">
              –
            </div>
          </div>

          <div class="breakdown-grid">
            <div class="score-card sc-r-safe">
              <div class="score-value" id="h-r-safe">0</div>
              <div class="score-label">SR</div>
            </div>
            <div class="score-card sc-r-solid">
              <div class="score-value" id="h-r-solid">0</div>
              <div class="score-label">SoR</div>
            </div>
            <div class="score-card sc-r-likely">
              <div class="score-value" id="h-r-likely">0</div>
              <div class="score-label">LR</div>
            </div>
            <div class="score-card sc-r-lean">
              <div class="score-value" id="h-r-lean">0</div>
              <div class="score-label">LeR</div>
            </div>
            <div class="score-card sc-r-tilt">
              <div class="score-value" id="h-r-tilt">0</div>
              <div class="score-label">TR</div>
            </div>

            <div class="score-card sc-t">
              <div class="score-value" id="h-tie">0</div>
              <div class="score-label">T</div>
            </div>

            <div class="score-card sc-d-tilt">
              <div class="score-value" id="h-d-tilt">0</div>
              <div class="score-label">TD</div>
            </div>
            <div class="score-card sc-d-lean">
              <div class="score-value" id="h-d-lean">0</div>
              <div class="score-label">LeD</div>
            </div>
            <div class="score-card sc-d-likely">
              <div class="score-value" id="h-d-likely">0</div>
              <div class="score-label">LD</div>
            </div>
            <div class="score-card sc-d-solid">
              <div class="score-value" id="h-d-solid">0</div>
              <div class="score-label">SoD</div>
            </div>
            <div class="score-card sc-d-safe">
              <div class="score-value" id="h-d-safe">0</div>
              <div class="score-label">SD</div>
            </div>
          </div>
        </div>
      </div>

      <!-- SENATE SCOREBOARD -->
      <div class="scoreboard">
        <div class="scoreboard-inner">
          <div class="chamber-label">
            Senate
            <span>Majority: 51</span>
          </div>

          <div class="totals-bar">
            <div class="total-box">
              <div class="total-num t-rep" id="s-total-r">0</div>
              <div class="total-label">R seats</div>
            </div>
            <div class="total-box">
              <div class="total-num t-dem" id="s-total-d">0</div>
              <div class="total-label">D seats</div>
            </div>
          </div>

          <div class="majority-bar-wrapper">
            <div class="majority-bar" id="senate-majority-bar">
              <div
                class="majority-segment rep"
                id="senate-bar-r"
                style="width: 0%"
              ></div>
              <div
                class="majority-segment dem"
                id="senate-bar-d"
                style="width: 0%"
              ></div>
              <div
                class="majority-marker"
                id="senate-majority-marker"
              ></div>
            </div>
            <div class="majority-labels">
              <span>0</span>
              <span>100</span>
            </div>
          </div>

          <div class="status-line">
            <div class="status-primary" id="senate-status-primary">
              –
            </div>
            <div class="status-secondary" id="senate-status-secondary">
              –
            </div>
          </div>

          <div class="breakdown-grid">
            <div class="score-card sc-r-safe">
              <div class="score-value" id="s-r-safe">0</div>
              <div class="score-label">SR</div>
            </div>
            <div class="score-card sc-r-solid">
              <div class="score-value" id="s-r-solid">0</div>
              <div class="score-label">SoR</div>
            </div>
            <div class="score-card sc-r-likely">
              <div class="score-value" id="s-r-likely">0</div>
              <div class="score-label">LR</div>
            </div>
            <div class="score-card sc-r-lean">
              <div class="score-value" id="s-r-lean">0</div>
              <div class="score-label">LeR</div>
            </div>
            <div class="score-card sc-r-tilt">
              <div class="score-value" id="s-r-tilt">0</div>
              <div class="score-label">TR</div>
            </div>

            <div class="score-card sc-t">
              <div class="score-value" id="s-tie">0</div>
              <div class="score-label">T</div>
            </div>

            <div class="score-card sc-d-tilt">
              <div class="score-value" id="s-d-tilt">0</div>
              <div class="score-label">TD</div>
            </div>
            <div class="score-card sc-d-lean">
              <div class="score-value" id="s-d-lean">0</div>
              <div class="score-label">LeD</div>
            </div>
            <div class="score-card sc-d-likely">
              <div class="score-value" id="s-d-likely">0</div>
              <div class="score-label">LD</div>
            </div>
            <div class="score-card sc-d-solid">
              <div class="score-value" id="s-d-solid">0</div>
              <div class="score-label">SoD</div>
            </div>
            <div class="score-card sc-d-safe">
              <div class="score-value" id="s-d-safe">0</div>
              <div class="score-label">SD</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- CONTROLS -->
  <div class="controls-container">
    <div class="controls-header-row">
      <div class="slider-header">
        National Environment:
        <span id="margin-display">Even</span>
      </div>
</div>
    <div class="slider-row">
      <input
        type="range"
        id="swing-slider"
        min="-15"
        max="15"
        step="0.1"
        value="0"
      />
    </div>
    <div class="slider-scale">
      <span>D+15</span>
      <span>D+5</span>
      <span class="center">Even</span>
      <span>R+5</span>
      <span>R+15</span>
    </div>

    <div class="preset-buttons">
      <button class="preset-btn" data-swing="-5">
        D+5
</button>
      <button class="preset-btn active" data-swing="0">
        Even
</button>
      <button class="preset-btn" data-swing="5">
        R+5
</button>
      <button class="preset-btn" data-swing="-2">
        D+2
      </button>
      <button class="preset-btn" data-swing="2">
        R+2
      </button>
      <button class="preset-btn" data-swing="-8">
        D+8
      </button>
      <button class="preset-btn" data-swing="8">
        R+8
      </button>
    </div>
<div class="legend-item"><div class="dot r-safe"></div>Safe R &gt; 15</div>
      <div class="legend-item"><div class="dot r-solid"></div>Solid R 5–15</div>
      <div class="legend-item"><div class="dot r-likely"></div>Likely R 2.5–5</div>
      <div class="legend-item"><div class="dot r-lean"></div>Lean R 1–2.5</div>
      <div class="legend-item"><div class="dot r-tilt"></div>Tilt R &lt; 1</div>
      <div class="legend-item"><div class="dot pure-toss"></div>Tossup</div>
      <div class="legend-item"><div class="dot d-tilt"></div>Tilt D &lt; 1</div>
      <div class="legend-item"><div class="dot d-lean"></div>Lean D 1–2.5</div>
      <div class="legend-item"><div class="dot d-likely"></div>Likely D 2.5–5</div>
      <div class="legend-item"><div class="dot d-solid"></div>Solid D 5–15</div>
      <div class="legend-item"><div class="dot d-safe"></div>Safe D &gt; 15</div>
Solid D 5–15</div>
      <div class="legend-item"><div class="dot d-safe"></div>Safe D &gt; 15</div>
    </div>
  </div>

  <div class="vis-container">
    <div class="panel">
      <h2 class="section-title">
        House
</h2>
      <div class="map-wrapper">
        <div id="house-svg-container" class="house-svg-container"><div class="house-loading">Loading district map…</div></div>
      </div>
    </div>

    <div class="panel">
      <h2 class="section-title">
        Senate
</h2>
      <div class="senate-spectrum-wrapper">
        <div class="senate-label-row">
          <span><strong>D</strong> &larr;</span>
          <span>★ tipping</span>
          <span>&rarr; <strong>R</strong></span>
        </div>
        <div id="senate-grid" class="senate-spectrum"></div>
      </div>
    </div>
  </div>

  <!-- RAW DATA (unchanged model) -->
  <script id="raw-house-string" type="text/plain">

state_name,district,path_id,d_ratio,r_ratio
Alabama,1,101,0.4543,1.5515
Alabama,2,102,1.1108,0.912
Alabama,3,103,0.5435,1.4647
Alabama,4,104,0.3399,1.6635
Alabama,5,105,0.7203,1.2831
Alabama,6,106,0.625,1.3803
Alabama,7,107,1.2676,0.7603
Alaska,0,200,0.8573,1.0953
Arizona,1,401,0.9932,1.0257
Arizona,2,402,0.8698,1.1442
Arizona,3,403,1.4324,0.5911
Arizona,4,404,1.0897,0.9229
Arizona,5,405,0.8173,1.1938
Arizona,6,406,1.0161,1.0005
Arizona,7,407,1.2521,0.7701
Arizona,8,408,0.8565,1.1586
Arizona,9,409,0.7048,1.3077
Arkansas,1,501,0.5465,1.4396
Arkansas,2,502,0.8495,1.1357
Arkansas,3,503,0.7493,1.2266
Arkansas,4,504,0.603,1.3862
California,1,601,1.1282,0.8488
California,2,602,1.2578,0.7249
California,3,603,1.1048,0.8671
California,4,604,1.1542,0.8281
California,5,605,0.795,1.1861
California,6,606,1.0884,0.8871
California,7,607,1.1344,0.8428
California,8,608,1.3555,0.6303
California,9,609,1.1209,0.8578
California,10,610,1.3484,0.6333
California,11,611,1.6936,0.2827
California,12,612,1.7501,0.2137
California,13,613,1.0118,0.9713
California,14,614,1.3538,0.6151
California,15,615,1.4946,0.488
California,16,616,1.4965,0.4851
California,17,617,1.3936,0.5691
California,18,618,1.2973,0.6871
California,19,619,1.3551,0.6235
California,20,620,0.6781,1.305
California,21,621,1.0696,0.9169
California,22,622,0.9888,0.9956
California,23,623,0.8075,1.1723
California,24,624,1.2613,0.7221
California,25,625,1.0727,0.9231
California,26,626,1.1642,0.8223
California,27,627,1.1048,0.8757
California,28,628,1.2629,0.7169
California,29,629,1.3516,0.6353
California,30,630,1.4139,0.5681
California,31,631,1.1306,0.8512
California,32,632,1.264,0.7237
California,33,633,1.1068,0.8761
California,34,634,1.5126,0.4502
California,35,635,1.0841,0.8956
California,36,636,1.406,0.5787
California,37,637,1.6286,0.3667
California,38,638,1.129,0.8464
California,39,639,1.1023,0.8773
California,40,640,0.8778,1.097
California,41,641,1.1501,0.8311
California,42,642,1.1387,0.8406
California,43,643,1.5089,0.4801
California,44,644,1.3665,0.6191
California,45,645,1.0462,0.9353
California,46,646,1.1702,0.8102
California,47,647,1.1008,0.8653
California,48,648,1.0437,0.9434
California,49,649,1.1298,0.8526
California,50,650,1.1923,0.7898
California,51,651,1.194,0.7918
California,52,652,1.1901,0.8012
Colorado,1,801,1.588,0.4142
Colorado,2,802,1.4183,0.5767
Colorado,3,803,0.9088,1.0767
Colorado,4,804,0.8208,1.1626
Colorado,5,805,0.9131,1.068
Colorado,6,806,1.2103,0.7767
Colorado,7,807,1.1614,0.8255
Colorado,8,808,0.9887,0.9957
Connecticut,1,901,1.2548,0.7576
Connecticut,2,902,1.0978,0.9097
Connecticut,3,903,1.1609,0.8437
Connecticut,4,904,1.2609,0.7538
Connecticut,5,905,1.0768,0.9322
Delaware,0,1000,1.1724,0.8412
Florida,1,1201,0.6395,1.3673
Florida,2,1202,0.8388,1.175
Florida,3,1203,0.8069,1.2066
Florida,4,1204,0.9023,1.1129
Florida,5,1205,0.8016,1.2078
Florida,6,1206,0.7162,1.2988
Florida,7,1207,0.8944,1.118
Florida,8,1208,0.7943,1.2189
Florida,9,1209,1.0594,0.9569
Florida,10,1210,1.2563,0.7625
Florida,11,1211,0.8574,1.158
Florida,12,1212,0.669,1.3432
Florida,13,1213,0.9026,1.1135
Florida,14,1214,1.1028,0.9155
Florida,15,1215,0.9044,1.1019
Florida,16,1216,0.866,1.1505
Florida,17,1217,0.7803,1.2376
Florida,18,1218,0.7228,1.2914
Florida,19,1219,0.7266,1.2904
Florida,20,1220,1.4359,0.5973
Florida,21,1221,0.8564,1.1632
Florida,22,1222,1.0838,0.9393
Florida,23,1223,1.0457,0.9759
Florida,24,1224,1.3374,0.6936
Florida,25,1225,1.0798,0.9403
Florida,26,1226,0.6665,1.3486
Florida,27,1227,0.8753,1.1433
Florida,28,1228,0.7652,1.2522
Georgia,1,1301,0.8659,1.1572
Georgia,2,1302,1.1099,0.9235
Georgia,3,1303,0.7216,1.2963
Georgia,4,1304,1.5674,0.4665
Georgia,5,1305,1.7658,0.275
Georgia,6,1306,1.5437,0.4945
Georgia,7,1307,0.7954,1.2143
Georgia,8,1308,0.7142,1.307
Georgia,9,1309,0.6747,1.3386
Georgia,10,1310,0.8136,1.2065
Georgia,11,1311,0.7839,1.229
Georgia,12,1312,0.8835,1.1413
Georgia,13,1313,1.464,0.5698
Georgia,14,1314,0.6478,1.3668
Hawaii,1,1501,1.2733,0.7383
Hawaii,2,1502,1.2367,0.7659
Idaho,1,1601,0.5433,1.4319
Idaho,2,1602,0.7272,1.242
Illinois,1,1701,1.3539,0.6696
Illinois,2,1702,1.3638,0.6577
Illinois,3,1703,1.3458,0.6749
Illinois,4,1704,1.3131,0.7047
Illinois,5,1705,1.4071,0.6194
Illinois,6,1706,1.0765,0.9338
Illinois,7,1707,1.7001,0.3359
Illinois,8,1708,1.0932,0.9215
Illinois,9,1709,1.4022,0.6256
Illinois,10,1710,1.2495,0.7692
Illinois,11,1711,1.1378,0.874
Illinois,12,1712,0.5702,1.4249
Illinois,13,1713,1.1259,0.8817
Illinois,14,1714,1.0737,0.9372
Illinois,15,1715,0.6062,1.3862
Illinois,16,1716,0.7837,1.2155
Illinois,17,1717,1.0664,0.939
Indiana,1,1801,1.0231,0.9843
Indiana,2,1802,0.7448,1.2546
Indiana,3,1803,0.6947,1.3001
Indiana,4,1804,0.7129,1.2806
Indiana,5,1805,0.8418,1.154
Indiana,6,1806,0.6804,1.313
Indiana,7,1807,1.4471,0.571
Indiana,8,1808,0.6464,1.3475
Indiana,9,1809,0.7088,1.2875
Iowa,1,1901,0.9324,1.0743
Iowa,2,1902,0.9176,1.0906
Iowa,3,1903,0.9762,1.0352
Iowa,4,1904,0.6957,1.3069
Kansas,1,2001,0.6926,1.2996
Kansas,2,2002,0.8119,1.1825
Kansas,3,2003,1.0592,0.945
Kansas,4,2004,0.7763,1.2207
Kentucky,1,2101,0.5323,1.466
Kentucky,2,2102,0.5925,1.4047
Kentucky,3,2103,1.2136,0.7967
Kentucky,4,2104,0.6499,1.3443
Kentucky,5,2105,0.3613,1.6332
Kentucky,6,2106,0.8604,1.1363
Louisiana,1,2201,0.6233,1.366
Louisiana,2,2202,1.3399,0.6694
Louisiana,3,2203,0.5577,1.4401
Louisiana,4,2204,0.483,1.5154
Louisiana,5,2205,0.6443,1.3531
Louisiana,6,2206,1.1741,0.8379
Maine,1,2301,1.2367,0.7655
Maine,2,2302,0.921,1.075
Maryland,1,2401,0.8367,1.1511
Maryland,2,2402,1.1999,0.7932
Maryland,3,2403,1.2505,0.7356
Maryland,4,2404,1.7694,0.2377
Maryland,5,2405,1.3566,0.6473
Maryland,6,2406,1.0681,0.92
Maryland,7,2407,1.6187,0.3864
Maryland,8,2408,1.591,0.4095
Massachusetts,1,2501,1.1545,0.8462
Massachusetts,2,2502,1.2542,0.741
Massachusetts,3,2503,1.2097,0.7921
Massachusetts,4,2504,1.2184,0.7857
Massachusetts,5,2505,1.4764,0.525
Massachusetts,6,2506,1.2294,0.777
Massachusetts,7,2507,1.6559,0.339
Massachusetts,8,2508,1.2868,0.7176
Massachusetts,9,2509,1.1297,0.8796
Michigan,1,2601,0.8007,1.2024
Michigan,2,2602,0.7084,1.2912
Michigan,3,2603,1.0991,0.9085
Michigan,4,2604,0.9622,1.0444
Michigan,5,2605,0.7408,1.2611
Michigan,6,2606,1.2497,0.7441
Michigan,7,2607,1.0055,1.001
Michigan,8,2608,1.0001,1.0097
Michigan,9,2609,0.6865,1.3151
Michigan,10,2610,0.946,1.049
Michigan,11,2611,1.1803,0.8218
Michigan,12,2612,1.378,0.5742
Michigan,13,2613,1.4372,0.5694
Minnesota,1,2701,0.8914,1.1056
Minnesota,2,2702,1.0749,0.9254
Minnesota,3,2703,1.2334,0.7693
Minnesota,4,2704,1.3819,0.624
Minnesota,5,2705,1.6483,0.3564
Minnesota,6,2706,0.8111,1.1816
Minnesota,7,2707,0.6403,1.3536
Minnesota,8,2708,0.8701,1.1309
Mississippi,1,2801,0.6381,1.3625
Mississippi,2,2802,1.2353,0.7892
Mississippi,3,2803,0.7231,1.2871
Mississippi,4,2804,0.5837,1.4201
Missouri,1,2901,1.6118,0.408
Missouri,2,2902,0.9,1.1012
Missouri,3,2903,0.8128,1.1892
Missouri,4,2904,0.8031,1.2022
Missouri,5,2905,0.8298,1.1733
Missouri,6,2906,0.7453,1.2576
Missouri,7,2907,0.581,1.4199
Missouri,8,2908,0.4673,1.5353
Montana,1,3001,0.8833,1.0887
Montana,2,3002,0.6965,1.2687
Nebraska,1,3101,0.8856,1.1208
Nebraska,2,3102,1.0692,0.9442
Nebraska,3,3103,0.4663,1.5325
Nevada,1,3201,1.0402,0.9635
Nevada,2,3202,0.8668,1.1205
Nevada,3,3203,1.0105,0.9949
Nevada,4,3204,1.0402,0.9623
New Hampshire,1,3301,1.0463,0.9746
New Hampshire,2,3302,1.0616,0.9575
New Jersey,1,3401,1.2135,0.8008
New Jersey,2,3402,0.8904,1.1156
New Jersey,3,3403,1.1047,0.9036
New Jersey,4,3404,0.7092,1.2926
New Jersey,5,3405,1.0311,0.9697
New Jersey,6,3406,1.0756,0.9142
New Jersey,7,3407,1.0032,0.9966
New Jersey,8,3408,1.2595,0.7359
New Jersey,9,3409,0.9942,0.9871
New Jersey,10,3410,1.5428,0.4769
New Jersey,11,3411,1.1042,0.896
New Jersey,12,3412,1.254,0.737
New Mexico,1,3501,1.1399,0.8512
New Mexico,2,3502,0.9949,1.0012
New Mexico,3,3503,1.0665,0.9298
New York,1,3601,0.9163,1.0904
New York,2,3602,0.88,1.1332
New York,3,3603,0.9747,1.0313
New York,4,3604,1.0359,0.9791
New York,5,3605,1.456,0.5657
New York,6,3606,1.0827,0.9214
New York,7,3607,1.4817,0.5156
New York,8,3608,1.4737,0.5462
New York,9,3609,1.4341,0.5755
New York,10,3610,1.6366,0.3736
New York,11,3611,0.7639,1.2303
New York,12,3612,1.6729,0.3454
New York,13,3613,1.6319,0.3923
New York,14,3614,1.3442,0.6662
New York,15,3615,1.523,0.5082
New York,16,3616,1.3716,0.6655
New York,17,3617,1.0332,0.991
New York,18,3618,1.0629,0.964
New York,19,3619,1.0443,0.977
New York,20,3620,1.1693,0.8499
New York,21,3621,0.8161,1.2063
New York,22,3622,1.1085,0.9215
New York,23,3623,0.8092,1.2068
New York,24,3624,0.7895,1.2293
New York,25,3625,1.2145,0.8076
New York,26,3626,1.2192,0.7956
North Carolina,1,3701,0.9043,1.1096
North Carolina,2,3702,1.3621,0.6448
North Carolina,3,3703,0.883,1.1299
North Carolina,4,3704,1.4805,0.5305
North Carolina,5,3705,0.8387,1.1687
North Carolina,6,3706,0.8422,1.16
North Carolina,7,3707,0.8795,1.1313
North Carolina,8,3708,0.8205,1.1841
North Carolina,9,3709,0.8578,1.1496
North Carolina,10,3710,0.8389,1.1681
North Carolina,11,3711,0.9211,1.0835
North Carolina,12,3712,1.4841,0.5185
North Carolina,13,3713,0.8501,1.1552
North Carolina,14,3714,0.8658,1.1412
North Dakota,0,3800,0.6371,1.3559
Ohio,1,3901,0.9986,1.0207
Ohio,2,3902,0.5909,1.4197
Ohio,3,3903,1.4412,0.5898
Ohio,4,3904,0.5847,1.4233
Ohio,5,3905,0.7799,1.2333
Ohio,6,3906,0.6685,1.3436
Ohio,7,3907,0.912,1.1066
Ohio,8,3908,0.8636,1.1514
Ohio,9,3909,0.9159,1.1008
Ohio,10,3910,0.9445,1.0725
Ohio,11,3911,1.5979,0.444
Ohio,12,3912,0.7147,1.2976
Ohio,13,3913,1.0598,0.9618
Ohio,14,3914,0.8157,1.2002
Ohio,15,3915,0.9213,1.0948
Oklahoma,1,4001,0.7904,1.199
Oklahoma,2,4002,0.4431,1.5467
Oklahoma,3,4003,0.5442,1.4423
Oklahoma,4,4004,0.6713,1.3185
Oklahoma,5,4005,0.8291,1.1601
Oregon,1,4101,1.3915,0.5907
Oregon,2,4102,0.7267,1.2497
Oregon,3,4103,1.4755,0.5079
Oregon,4,4104,1.1283,0.8521
Oregon,5,4105,1.0922,0.8878
Oregon,6,4106,1.1207,0.8585
Pennsylvania,1,4201,1.0284,0.991
Pennsylvania,2,4202,1.3929,0.6332
Pennsylvania,3,4203,1.8231,0.2157
Pennsylvania,4,4204,1.188,0.8349
Pennsylvania,5,4205,1.3207,0.706
Pennsylvania,6,4206,1.1427,0.8792
Pennsylvania,7,4207,0.991,1.0255
Pennsylvania,8,4208,0.9389,1.0813
Pennsylvania,9,4209,0.6331,1.3759
Pennsylvania,10,4210,0.9692,1.045
Pennsylvania,11,4211,0.8039,1.2087
Pennsylvania,12,4212,1.2242,0.8021
Pennsylvania,13,4213,0.5555,1.4532
Pennsylvania,14,4214,0.6825,1.3318
Pennsylvania,15,4215,0.6334,1.3767
Pennsylvania,16,4216,0.7908,1.2241
Pennsylvania,17,4217,1.0823,0.9392
Rhode Island,1,4401,1.2416,0.7593
Rhode Island,2,4402,1.0833,0.9144
South Carolina,1,4501,0.8848,1.1194
South Carolina,2,4502,0.8757,1.1287
South Carolina,3,4503,0.5762,1.4236
South Carolina,4,4504,0.7744,1.2245
South Carolina,5,4505,0.7854,1.219
South Carolina,6,4506,1.2534,0.7603
South Carolina,7,4507,0.7516,1.2579
South Dakota,0,4600,0.7089,1.2738
Tennessee,1,4701,0.4258,1.5745
Tennessee,2,4702,0.6705,1.3301
Tennessee,3,4703,0.6503,1.3511
Tennessee,4,4704,0.5717,1.4296
Tennessee,5,4705,0.8346,1.1664
Tennessee,6,4706,0.6579,1.3451
Tennessee,7,4707,0.7894,1.2132
Tennessee,8,4708,0.5976,1.4056
Tennessee,9,4709,1.466,0.5504
Texas,1,4801,0.5139,1.4916
Texas,2,4802,0.7853,1.2201
Texas,3,4803,0.7658,1.2114
Texas,4,4804,0.7582,1.2299
Texas,5,4805,0.7983,1.207
Texas,6,4806,0.7805,1.2163
Texas,7,4807,1.2476,0.7398
Texas,8,4808,0.7356,1.2683
Texas,9,4809,0.8199,1.1944
Texas,10,4810,0.7853,1.2147
Texas,11,4811,0.666,1.3347
Texas,12,4812,0.7758,1.2317
Texas,13,4813,0.5462,1.4566
Texas,14,4814,0.7712,1.2353
Texas,15,4815,0.8414,1.1747
Texas,16,4816,1.1892,0.8245
Texas,17,4817,0.795,1.2046
Texas,18,4818,1.5882,0.438
Texas,19,4819,0.4903,1.5129
Texas,20,4820,1.3141,0.7034
Texas,21,4821,0.7961,1.21
Texas,22,4822,0.7824,1.2034
Texas,23,4823,0.8694,1.1402
Texas,24,4824,0.8495,1.1468
Texas,25,4825,0.7739,1.2337
Texas,26,4826,0.7745,1.2289
Texas,27,4827,0.8029,1.2038
Texas,28,4828,0.9197,1.1002
Texas,29,4829,1.336,0.6849
Texas,30,4830,1.5054,0.5157
Texas,31,4831,0.7938,1.2076
Texas,32,4832,0.8288,1.1594
Texas,33,4833,1.3495,0.6544
Texas,34,4834,0.9207,1.0964
Texas,35,4835,0.9145,1.0966
Texas,36,4836,0.7629,1.2406
Texas,37,4837,1.5909,0.4139
Texas,38,4838,0.7996,1.1954
Utah,1,4901,1.2497,0.7378
Utah,2,4902,0.7021,1.262
Utah,3,4903,0.5814,1.3946
Utah,4,4904,0.6696,1.3018
Vermont,0,5000,1.3324,0.6544
Virginia,1,5101,0.9711,1.0411
Virginia,2,5102,1.0201,0.9944
Virginia,3,5103,1.3794,0.6416
Virginia,4,5104,1.3589,0.6613
Virginia,5,5105,0.8977,1.1173
Virginia,6,5106,0.7762,1.2324
Virginia,7,5107,1.046,0.957
Virginia,8,5108,1.5266,0.4817
Virginia,9,5109,0.5705,1.4381
Virginia,10,5110,1.0954,0.8946
Virginia,11,5111,1.3607,0.6312
Washington,1,5301,1.2966,0.6814
Washington,2,5302,1.2471,0.7343
Washington,3,5303,0.9721,1.0091
Washington,4,5304,0.7938,1.185
Washington,5,5305,0.8936,1.0833
Washington,6,5306,1.2023,0.7792
Washington,7,5307,1.7772,0.2178
Washington,8,5308,1.0621,0.9141
Washington,9,5309,1.4257,0.5553
Washington,10,5310,1.1882,0.7909
West Virginia,1,5401,0.5568,1.4308
West Virginia,2,5402,0.6051,1.382
Wisconsin,1,5501,0.9733,1.0345
Wisconsin,2,5502,1.4356,0.5862
Wisconsin,3,5503,0.9427,1.0628
Wisconsin,4,5504,1.5508,0.4689
Wisconsin,5,5505,0.7921,1.2131
Wisconsin,6,5506,0.851,1.1562
Wisconsin,7,5507,0.7868,1.2149
Wisconsin,8,5508,0.8538,1.1545
Wyoming,0,5600,0.5404,1.4523

  
  </script>

  <script id="raw-senate-string" type="text/plain">
State-D-R
WY-0.5657-1.4364
WV-0.5896-1.3696
ID-0.6339-1.3495
OK-0.6824-1.2748
AR-0.6971-1.2832
AL-0.7065-1.2758
KY-0.7052-1.2697
TN-0.7150-1.2746
SD-0.7142-1.2636
MS-0.7698-1.2148
LA-0.7922-1.1845
MT-0.7992-1.1639
SC-0.8328-1.1638
NE-0.8435-1.1573
FL-0.8402-1.1431
IA-0.8757-1.1229
TX-0.8788-1.1232
KS-0.8970-1.1057
AK-0.8901-1.0915
OH-0.9058-1.1085
NC-0.9868-1.0058
MI-0.9989-0.9968
GA-1.0223-0.9746
NH-1.0715-0.9454
NJ-1.0497-0.9260
MN-1.0853-0.9273
NM-1.0933-0.9284
VA-1.0805-0.9138
ME-1.1288-0.9105
IL-1.1201-0.8808
RI-1.1505-0.8378
CO-1.1729-0.8348
OR-1.1845-0.8213
DE-1.1839-0.8145
MA-1.2744-0.7194
  </script>

  <div id="tooltip"></div>

  <script>
    // --- House map grid layout (same positions as before) ---
    const stateLayout = {
      Alaska: { r: 1, c: 1 },
      Maine: { r: 1, c: 11 },
      Washington: { r: 2, c: 2 },
      Idaho: { r: 2, c: 3 },
      Montana: { r: 2, c: 4 },
      "North Dakota": { r: 2, c: 5 },
      Minnesota: { r: 2, c: 6 },
      Wisconsin: { r: 2, c: 8 },
      Michigan: { r: 2, c: 9 },
      "New York": { r: 1, c: 10 },
      Vermont: { r: 2, c: 11 },
      "New Hampshire": { r: 2, c: 12 },

      Oregon: { r: 3, c: 2 },
      Nevada: { r: 3, c: 3 },
      Wyoming: { r: 3, c: 4 },
      "South Dakota": { r: 3, c: 5 },
      Iowa: { r: 3, c: 6 },
      Illinois: { r: 3, c: 7 },
      Indiana: { r: 3, c: 8 },
      Ohio: { r: 3, c: 9 },
      Pennsylvania: { r: 3, c: 10 },
      "New Jersey": { r: 3, c: 11 },
      Connecticut: { r: 3, c: 12 },

      California: { r: 4, c: 2 },
      Utah: { r: 4, c: 3 },
      Colorado: { r: 4, c: 4 },
      Nebraska: { r: 4, c: 5 },
      Missouri: { r: 4, c: 6 },
      Kentucky: { r: 4, c: 7 },
      "West Virginia": { r: 4, c: 8 },
      Virginia: { r: 4, c: 9 },
      Maryland: { r: 4, c: 10 },
      Delaware: { r: 4, c: 11 },
      "Rhode Island": { r: 4, c: 12 },

      Arizona: { r: 5, c: 3 },
      "New Mexico": { r: 5, c: 4 },
      Kansas: { r: 5, c: 5 },
      Arkansas: { r: 5, c: 6 },
      Tennessee: { r: 5, c: 7 },
      "North Carolina": { r: 5, c: 8 },
      "South Carolina": { r: 5, c: 9 },

      Oklahoma: { r: 6, c: 5 },
      Louisiana: { r: 6, c: 6 },
      Mississippi: { r: 6, c: 7 },
      Alabama: { r: 6, c: 8 },
      Georgia: { r: 6, c: 9 },

      Hawaii: { r: 7, c: 1 },
      Texas: { r: 7, c: 5 },
      Florida: { r: 7, c: 9 },
      Massachusetts: { r: 2, c: 11 }
    };

    const stateAbbreviations = {
      Alabama: "AL",
      Alaska: "AK",
      Arizona: "AZ",
      Arkansas: "AR",
      California: "CA",
      Colorado: "CO",
      Connecticut: "CT",
      Delaware: "DE",
      Florida: "FL",
      Georgia: "GA",
      Hawaii: "HI",
      Idaho: "ID",
      Illinois: "IL",
      Indiana: "IN",
      Iowa: "IA",
      Kansas: "KS",
      Kentucky: "KY",
      Louisiana: "LA",
      Maine: "ME",
      Maryland: "MD",
      Massachusetts: "MA",
      Michigan: "MI",
      Minnesota: "MN",
      Mississippi: "MS",
      Missouri: "MO",
      Montana: "MT",
      Nebraska: "NE",
      Nevada: "NV",
      "New Hampshire": "NH",
      "New Jersey": "NJ",
      "New Mexico": "NM",
      "New York": "NY",
      "North Carolina": "NC",
      "North Dakota": "ND",
      Ohio: "OH",
      Oklahoma: "OK",
      Oregon: "OR",
      Pennsylvania: "PA",
      "Rhode Island": "RI",
      "South Carolina": "SC",
      "South Dakota": "SD",
      Tennessee: "TN",
      Texas: "TX",
      Utah: "UT",
      Vermont: "VT",
      Virginia: "VA",
      Washington: "WA",
      "West Virginia": "WV",
      Wisconsin: "WI",
      Wyoming: "WY"
    };

    // Baseline: seats not up in Senate this cycle
    const BASE_SENATE_D = 34;
    const BASE_SENATE_R = 31;

    function getWinCategory(margin) {
      const absM = Math.abs(margin);
      if (absM < 0.05) return { code: "pure-toss", type: "Tossup" };

      if (margin > 0) {
        if (absM >= 15) return { code: "r-safe", type: "Safe R" };
        if (absM >= 5) return { code: "r-solid", type: "Solid R" };
        if (absM >= 2.5) return { code: "r-likely", type: "Likely R" };
        if (absM >= 1) return { code: "r-lean", type: "Lean R" };
        return { code: "r-tilt", type: "Tilt R" };
      } else {
        if (absM >= 15) return { code: "d-safe", type: "Safe D" };
        if (absM >= 5) return { code: "d-solid", type: "Solid D" };
        if (absM >= 2.5) return { code: "d-likely", type: "Likely D" };
        if (absM >= 1) return { code: "d-lean", type: "Lean D" };
        return { code: "d-tilt", type: "Tilt D" };
      }
    }

    function parseSenateData() {
      const raw = document
        .getElementById("raw-senate-string")
        .textContent.trim();
      const lines = raw.split(/[\r\n]+/).filter(
        (l) => l && !l.toLowerCase().startsWith("state")
      );
      const results = [];
      for (const line of lines) {
        const parts = line.split("-");
        if (parts.length >= 3) {
          results.push({
            s: parts[0],
            d: parseFloat(parts[1]),
            r: parseFloat(parts[2])
          });
        }
      }
      return results;
    }

    
    function parseHouseData() {
      // CSV: state_name,district,path_id,d_ratio,r_ratio
      const raw = document
        .getElementById("raw-house-string")
        .textContent.trim();

      const lines = raw
        .split(/[
]+/)
        .map((l) => l.trim())
        .filter(Boolean);

      // Drop header
      if (lines.length && lines[0].toLowerCase().includes("state_name")) {
        lines.shift();
      }

      const districts = [];
      for (const line of lines) {
        const parts = line.split(",");
        if (parts.length < 5) continue;

        const state = parts[0].trim();
        const districtNum = parseInt(parts[1], 10);
        const pathIdNum = parseInt(parts[2], 10);
        const dRatio = parseFloat(parts[3]);
        const rRatio = parseFloat(parts[4]);

        if (!state || Number.isNaN(districtNum) || Number.isNaN(pathIdNum)) continue;

        districts.push({
          state,
          id: districtNum === 0 ? "at-large" : String(districtNum),
          pathId: String(pathIdNum).padStart(4, "0"),
          rRatio,
          dRatio
        });
      }
      return districts;
    }

const mapEl = document.getElementById("house-svg-container");
    let houseSVG = null;
    let allHouseDistricts = [];
    let senateData = [];

    
    async function buildHouseMap() {
      allHouseDistricts = parseHouseData();

      // Load SVG (expected to be in the same folder as this HTML)
      mapEl.innerHTML =
        '<div class="house-loading">Loading district map…</div>';

      let svgText = "";
      try {
        const res = await fetch("house.svg", { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        svgText = await res.text();
      } catch (err) {
        console.error("Failed to load house.svg:", err);
        mapEl.innerHTML =
          '<div class="house-error">Couldn’t load <b>house.svg</b>. Put <b>house.svg</b> next to this HTML file (same folder) on your site.</div>';
        return;
      }

      // Parse as SVG and inline into the DOM (so we can style + bind hover events)
      const parser = new DOMParser();
      const doc = parser.parseFromString(svgText, "image/svg+xml");
      const svg = doc.querySelector("svg");
      if (!svg) {
        mapEl.innerHTML =
          '<div class="house-error">house.svg loaded, but no &lt;svg&gt; element was found.</div>';
        return;
      }

      mapEl.innerHTML = "";
      mapEl.appendChild(document.importNode(svg, true));
      houseSVG = mapEl.querySelector("svg");

      // Responsive sizing
      houseSVG.removeAttribute("width");
      houseSVG.removeAttribute("height");
      houseSVG.style.width = "100%";
      houseSVG.style.height = "100%";
      houseSVG.style.display = "block";

      // Hide the old layer if present
      houseSVG.querySelectorAll(".cdOLD").forEach((el) => {
        el.style.display = "none";
        el.style.pointerEvents = "none";
      });

      // Bind data rows to SVG districts by path id (4-digit FIPS+district, e.g. 0101)
      const missing = [];
      allHouseDistricts.forEach((d) => {
        const el = houseSVG.querySelector(`[id="${d.pathId}"]`);
        if (!el) {
          missing.push(d.pathId);
          return;
        }
        d.element = el;
        d.type = "house";

        el.style.cursor = "pointer";
        el.addEventListener("mousemove", (e) => showTooltip(e, d));
        el.addEventListener("mouseleave", hideTooltip);
      });

      if (missing.length) {
        console.warn("Missing SVG districts (first 25 shown):", missing.slice(0, 25), "… total:", missing.length);
      }
    }

    function buildSenateSpectrum() {
      senateData = parseSenateData();
      // elements are created later during update
    }

    const slider = document.getElementById("swing-slider");
    const marginDisp = document.getElementById("margin-display");

    const houseStatusPrimary = document.getElementById(
      "house-status-primary"
    );
    const houseStatusSecondary = document.getElementById(
      "house-status-secondary"
    );
    const senateStatusPrimary = document.getElementById(
      "senate-status-primary"
    );
    const senateStatusSecondary = document.getElementById(
      "senate-status-secondary"
    );

    const houseBarR = document.getElementById("house-bar-r");
    const houseBarD = document.getElementById("house-bar-d");
    const houseMajorityMarker = document.getElementById(
      "house-majority-marker"
    );

    const senateBarR = document.getElementById("senate-bar-r");
    const senateBarD = document.getElementById("senate-bar-d");
    const senateMajorityMarker = document.getElementById(
      "senate-majority-marker"
    );

    const senateGrid = document.getElementById("senate-grid");

    function updateDashboard() {
      const swing = parseFloat(slider.value);

      // Display national environment
      if (swing > 0) {
        marginDisp.innerHTML = `<span style="color:var(--rep-lean)">R+${swing.toFixed(
          1
        )}</span>`;
      } else if (swing < 0) {
        marginDisp.innerHTML = `<span style="color:var(--dem-lean)">D+${Math.abs(
          swing
        ).toFixed(1)}</span>`;
      } else {
        marginDisp.textContent = "Even";
      }

      const natR = 50 + swing / 2;
      const natD = 50 - swing / 2;

      // --- HOUSE ---
      const hC = {
        rSafe: 0,
        rSolid: 0,
        rLikely: 0,
        rLean: 0,
        rTilt: 0,
        tie: 0,
        dTilt: 0,
        dLean: 0,
        dLikely: 0,
        dSolid: 0,
        dSafe: 0
      };

      allHouseDistricts.forEach((d) => {
        const rPts = d.rRatio * natR;
        const dPts = d.dRatio * natD;
        const total = rPts + dPts;
        const rShare = (rPts / total) * 100;
        const dShare = 100 - rShare;
        const margin = rShare - dShare;

        d.currR = rShare;
        d.currD = dShare;
        d.currMargin = margin;

        const cat = getWinCategory(margin);
        
        if (d.element) {
          const codes = [
            "r-safe",
            "r-solid",
            "r-likely",
            "r-lean",
            "r-tilt",
            "pure-toss",
            "d-tilt",
            "d-lean",
            "d-likely",
            "d-solid",
            "d-safe"
          ];

          const isSVG = d.element instanceof SVGElement;
          if (isSVG) {
            codes.forEach((c) => d.element.classList.remove(c));
            d.element.classList.add(cat.code);

            const codeToVar = {
              "r-safe": "--rep-safe",
              "r-solid": "--rep-solid",
              "r-likely": "--rep-likely",
              "r-lean": "--rep-lean",
              "r-tilt": "--rep-tilt",
              "pure-toss": "--tossup-pure",
              "d-tilt": "--dem-tilt",
              "d-lean": "--dem-lean",
              "d-likely": "--dem-likely",
              "d-solid": "--dem-solid",
              "d-safe": "--dem-safe"
            };

            const varName = codeToVar[cat.code] || "--tossup-pure";
            const fill = getComputedStyle(document.documentElement)
              .getPropertyValue(varName)
              .trim();
            d.element.style.fill = fill || "#9ca3af";

            // Keep borders readable (non-scaling via CSS)
            d.element.style.stroke = "rgba(255,255,255,0.25)";
            d.element.style.strokeWidth = "0.6";
            d.element.style.strokeLinejoin = "round";
          } else {
            d.element.className = `district-dot ${cat.code}`;
          }
        }
d.category = cat.type;

        if (cat.code === "pure-toss") hC.tie++;
        else if (cat.code === "r-safe") hC.rSafe++;
        else if (cat.code === "r-solid") hC.rSolid++;
        else if (cat.code === "r-likely") hC.rLikely++;
        else if (cat.code === "r-lean") hC.rLean++;
        else if (cat.code === "r-tilt") hC.rTilt++;
        else if (cat.code === "d-safe") hC.dSafe++;
        else if (cat.code === "d-solid") hC.dSolid++;
        else if (cat.code === "d-likely") hC.dLikely++;
        else if (cat.code === "d-lean") hC.dLean++;
        else if (cat.code === "d-tilt") hC.dTilt++;
      });

      document.getElementById("h-r-safe").textContent = hC.rSafe;
      document.getElementById("h-r-solid").textContent = hC.rSolid;
      document.getElementById("h-r-likely").textContent = hC.rLikely;
      document.getElementById("h-r-lean").textContent = hC.rLean;
      document.getElementById("h-r-tilt").textContent = hC.rTilt;
      document.getElementById("h-tie").textContent = hC.tie;
      document.getElementById("h-d-tilt").textContent = hC.dTilt;
      document.getElementById("h-d-lean").textContent = hC.dLean;
      document.getElementById("h-d-likely").textContent = hC.dLikely;
      document.getElementById("h-d-solid").textContent = hC.dSolid;
      document.getElementById("h-d-safe").textContent = hC.dSafe;

      const hTotalR =
        hC.rSafe + hC.rSolid + hC.rLikely + hC.rLean + hC.rTilt;
      const hTotalD =
        hC.dSafe + hC.dSolid + hC.dLikely + hC.dLean + hC.dTilt;
      document.getElementById("h-total-r").textContent = hTotalR;
      document.getElementById("h-total-d").textContent = hTotalD;

      // House majority bar (0–435)
      const houseTotalSeats = hTotalR + hTotalD + hC.tie;
      const houseSeatScale = 435; // we know this, but keep explicit
      const rPct = (hTotalR / houseSeatScale) * 100;
      const dPct = (hTotalD / houseSeatScale) * 100;

      houseBarR.style.width = `${rPct}%`;
      houseBarD.style.width = `${dPct}%`;

      const houseMajorityThreshold = 218;
      const majorityPosPct = (houseMajorityThreshold / houseSeatScale) * 100;
      houseMajorityMarker.style.left = `${majorityPosPct}%`;

      // House status text
      const houseDiff = hTotalR - hTotalD;
      let houseLeaderText, houseDetailText;
      if (hTotalR > hTotalD) {
        const marginSeats = hTotalR - hTotalD;
        const aboveMaj = hTotalR - houseMajorityThreshold;
        houseLeaderText = `<span class="party rep">Republicans</span> lead, ${hTotalR}-${hTotalD}`;
        houseDetailText =
          aboveMaj >= 0
            ? `Projected GOP majority by <strong>${marginSeats}</strong> seats (${aboveMaj} above 218)`
            : `GOP ahead in seats but below majority by <strong>${Math.abs(
                aboveMaj
              )}</strong>`;
      } else if (hTotalD > hTotalR) {
        const marginSeats = hTotalD - hTotalR;
        const aboveMaj = hTotalD - houseMajorityThreshold;
        houseLeaderText = `<span class="party dem">Democrats</span> lead, ${hTotalD}-${hTotalR}`;
        houseDetailText =
          aboveMaj >= 0
            ? `Projected Democratic majority by <strong>${marginSeats}</strong> seats (${aboveMaj} above 218)`
            : `Democrats ahead in seats but below majority by <strong>${Math.abs(
                aboveMaj
              )}</strong>`;
      } else {
        houseLeaderText = `Chamber locked at <span class="party">${hTotalD}</span>-<span class="party">${hTotalR}</span>`;
        houseDetailText = `No clear majority – tossups decide control`;
      }

      houseStatusPrimary.innerHTML = houseLeaderText;
      houseStatusSecondary.innerHTML = houseDetailText;

      // --- SENATE ---
      const sC = {
        rSafe: BASE_SENATE_R,
        rSolid: 0,
        rLikely: 0,
        rLean: 0,
        rTilt: 0,
        tie: 0,
        dTilt: 0,
        dLean: 0,
        dLikely: 0,
        dSolid: 0,
        dSafe: BASE_SENATE_D
      };

      senateData.forEach((s) => {
        const rPts = s.r * natR;
        const dPts = s.d * natD;
        const total = rPts + dPts;
        const rShare = (rPts / total) * 100;
        const dShare = 100 - rShare;
        const margin = rShare - dShare;

        s.currR = rShare;
        s.currD = dShare;
        s.currMargin = margin;

        if (!s.element) {
          const dot = document.createElement("div");
          dot.className = "senate-seat";
          dot.textContent = s.s;
          s.type = "senate";
          s.id = "Sen";
          dot.addEventListener("mousemove", (e) => showTooltip(e, s));
          dot.addEventListener("mouseleave", hideTooltip);
          s.element = dot;
        }
      });

      const sortedSenate = [...senateData].sort(
        (a, b) => a.currMargin - b.currMargin
      );

      senateGrid.innerHTML = "";
      sortedSenate.forEach((s) => {
        senateGrid.appendChild(s.element);
      });

      const ROWS = 5;
      sortedSenate.forEach((s, i) => {
        const cat = getWinCategory(s.currMargin);
        s.element.className = `senate-seat ${cat.code}`;
        s.category = cat.type;

        const colIndex = Math.floor(i / ROWS);
        const remainder = i % ROWS;
        const rowIndex =
          colIndex % 2 === 0 ? remainder : ROWS - 1 - remainder;

        s.element.style.gridColumn = colIndex + 1;
        s.element.style.gridRow = rowIndex + 1;

        if (cat.code === "pure-toss") sC.tie++;
        else if (cat.code === "r-safe") sC.rSafe++;
        else if (cat.code === "r-solid") sC.rSolid++;
        else if (cat.code === "r-likely") sC.rLikely++;
        else if (cat.code === "r-lean") sC.rLean++;
        else if (cat.code === "r-tilt") sC.rTilt++;
        else if (cat.code === "d-safe") sC.dSafe++;
        else if (cat.code === "d-solid") sC.dSolid++;
        else if (cat.code === "d-likely") sC.dLikely++;
        else if (cat.code === "d-lean") sC.dLean++;
        else if (cat.code === "d-tilt") sC.dTilt++;
      });

      document.getElementById("s-r-safe").textContent = sC.rSafe;
      document.getElementById("s-r-solid").textContent = sC.rSolid;
      document.getElementById("s-r-likely").textContent = sC.rLikely;
      document.getElementById("s-r-lean").textContent = sC.rLean;
      document.getElementById("s-r-tilt").textContent = sC.rTilt;
      document.getElementById("s-tie").textContent = sC.tie;
      document.getElementById("s-d-tilt").textContent = sC.dTilt;
      document.getElementById("s-d-lean").textContent = sC.dLean;
      document.getElementById("s-d-likely").textContent = sC.dLikely;
      document.getElementById("s-d-solid").textContent = sC.dSolid;
      document.getElementById("s-d-safe").textContent = sC.dSafe;

      const sTotalR =
        sC.rSafe + sC.rSolid + sC.rLikely + sC.rLean + sC.rTilt;
      const sTotalD =
        sC.dSafe + sC.dSolid + sC.dLikely + sC.dLean + sC.dTilt;

      document.getElementById("s-total-r").textContent = sTotalR;
      document.getElementById("s-total-d").textContent = sTotalD;

      // Senate majority bar
      const senateSeatScale = 100;
      const sRPct = (sTotalR / senateSeatScale) * 100;
      const sDPct = (sTotalD / senateSeatScale) * 100;

      senateBarR.style.width = `${sRPct}%`;
      senateBarD.style.width = `${sDPct}%`;

      const senateMajorityThreshold = 51;
      const senateMajorityPosPct =
        (senateMajorityThreshold / senateSeatScale) * 100;
      senateMajorityMarker.style.left = `${senateMajorityPosPct}%`;

      // Senate status text
      let senateLeaderText, senateDetailText;
      const senateDiff = sTotalR - sTotalD;

      if (sTotalR > sTotalD) {
        const marginSeats = sTotalR - sTotalD;
        const aboveMaj = sTotalR - senateMajorityThreshold;
        senateLeaderText = `<span class="party rep">Republicans</span> lead, ${sTotalR}-${sTotalD}`;
        senateDetailText =
          aboveMaj >= 0
            ? `Projected GOP control by <strong>${marginSeats}</strong> seats (${aboveMaj} above 51)`
            : `GOP ahead in seats but below control by <strong>${Math.abs(
                aboveMaj
              )}</strong>`;
      } else if (sTotalD > sTotalR) {
        const marginSeats = sTotalD - sTotalR;
        const aboveMaj = sTotalD - senateMajorityThreshold;
        senateLeaderText = `<span class="party dem">Democrats</span> lead, ${sTotalD}-${sTotalR}`;
        senateDetailText =
          aboveMaj >= 0
            ? `Projected Democratic control by <strong>${marginSeats}</strong> seats (${aboveMaj} above 51)`
            : `Democrats ahead in seats but below control by <strong>${Math.abs(
                aboveMaj
              )}</strong>`;
      } else {
        senateLeaderText = `Chamber tied at <span class="party">${sTotalD}</span>-<span class="party">${sTotalR}</span>`;
        senateDetailText = `Vice President would break ties if either side reaches 50`;
      }

      senateStatusPrimary.innerHTML = senateLeaderText;
      senateStatusSecondary.innerHTML = senateDetailText;
      // Mark tipping-point Senate seat: the 51st seat (majority threshold line)
      let tipping = null;

      sortedSenate.forEach((s) => {
        s.element.classList.remove("tipping");
      });

      // Use the leading party (even if below 51) to place the majority-line marker.
      let leadParty = null;
      if (sTotalR > sTotalD) leadParty = "R";
      else if (sTotalD > sTotalR) leadParty = "D";

      if (leadParty) {
        const VIRTUAL_SAFE_MARGIN = 1000; // placeholder for seats not up this cycle
        const allSeats = [];

        // Non-contested seats (not shown) – push as virtual extremes so the 51st seat lands correctly.
        for (let i = 0; i < BASE_SENATE_R; i++) {
          allSeats.push({ currMargin: VIRTUAL_SAFE_MARGIN, virtual: true });
        }
        for (let i = 0; i < BASE_SENATE_D; i++) {
          allSeats.push({ currMargin: -VIRTUAL_SAFE_MARGIN, virtual: true });
        }

        // Contested seats (shown)
        senateData.forEach((s) => allSeats.push(s));

        const ordered =
          leadParty === "R"
            ? [...allSeats].sort((a, b) => b.currMargin - a.currMargin) // most R → most D
            : [...allSeats].sort((a, b) => a.currMargin - b.currMargin); // most D → most R

        const targetIndex = senateMajorityThreshold - 1; // 51st (0-indexed)
        let candidate = ordered[targetIndex];

        if (candidate && candidate.element) {
          tipping = candidate;
        } else {
          // Fallback: find the nearest real (contested) seat around the target index.
          for (let k = 1; k < ordered.length; k++) {
            const left = ordered[targetIndex - k];
            const right = ordered[targetIndex + k];
            if (left && left.element) {
              tipping = left;
              break;
            }
            if (right && right.element) {
              tipping = right;
              break;
            }
          }
        }
      }

      if (tipping) tipping.element.classList.add("tipping");
    }

    // Tooltip
    const tooltip = document.getElementById("tooltip");

    function showTooltip(e, data) {
      const margin = data.currMargin ?? 0;
      const cat = getWinCategory(margin);
      const absMargin = Math.abs(margin);
      const winner =
        absMargin < 0.05 ? "Tossup" : margin > 0 ? "Republican" : "Democrat";

      let color = "var(--text-main)";
      if (margin > 0) color = "var(--rep-lean)";
      if (margin < 0) color = "var(--dem-lean)";
      if (absMargin < 0.05) color = "#9ca3af";

      const title =
        data.type === "house"
          ? `${data.state} ${
              data.id === "at-large" ? "At-Large" : "District " + data.id
            }`
          : `Senate – ${data.s}`;

      const rShare = data.currR ?? 50;
      const dShare = data.currD ?? 50;

      tooltip.innerHTML = `
        <strong class="tt-title">${title}</strong>
        <div class="tt-subtitle">
          <span class="pill" style="border-color:${color};color:${color}">
            ${cat.type}
          </span>
        </div>
        <div class="row">
          <span>Projected winner</span>
          <span class="val" style="color:${color}">${winner}</span>
        </div>
        <div class="row">
          <span>Margin</span>
          <span class="val" style="color:${color}">
            ${
              absMargin < 0.05
                ? "≈ EVEN"
                : `${margin > 0 ? "R" : "D"}+${absMargin.toFixed(1)}`
            }
          </span>
        </div>
        <div class="tt-divider"></div>
        <div class="row">
          <span>Republican share</span>
          <span class="val">${rShare.toFixed(1)}%</span>
        </div>
        <div class="row">
          <span>Democratic share</span>
          <span class="val">${dShare.toFixed(1)}%</span>
        </div>
      `;

      const offset = 14;
      const x = e.clientX + offset;
      const y = e.clientY + offset;

      tooltip.style.left = x + "px";
      tooltip.style.top = y + "px";
      tooltip.style.opacity = 1;
    }

    function hideTooltip() {
      tooltip.style.opacity = 0;
    }

    // Preset buttons
    const presetButtons = Array.from(
      document.querySelectorAll(".preset-btn")
    );
    presetButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const swing = parseFloat(btn.getAttribute("data-swing"));
        slider.value = swing;
        presetButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        updateDashboard();
      });
    });

    slider.addEventListener("input", () => {
      presetButtons.forEach((b) => b.classList.remove("active"));
      // Rehighlight the 0 preset when appropriate
      const zeroBtn = presetButtons.find(
        (b) => parseFloat(b.getAttribute("data-swing")) === 0
      );
      if (parseFloat(slider.value) === 0 && zeroBtn) {
        zeroBtn.classList.add("active");
      }
      updateDashboard();
    });

    // Init
    (async () => {
      await buildHouseMap();
      buildSenateSpectrum();
      updateDashboard();
    })();
  </script>
</body>
</html>
